<!DOCTYPE html>
<html lang="en" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    <meta name="generator" content="Hugo 0.37.1" />
    
    <title>Python - Using the vSphere Automation SDK &middot; </title>
    <meta content="Python - Using the vSphere Automation SDK - " property="og:title">
    <meta content=" - " property="og:description">
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif:300,300i,400,400i,700,700i|Source+Code+Pro:300,300i,400,400i" rel="stylesheet">
    <link rel="stylesheet" href="https://kmruddy.github.iocss/print.css" media="print">
    <link rel="stylesheet" href="https://kmruddy.github.iocss/poole.css">
    <link rel="stylesheet" href="https://kmruddy.github.iocss/hyde.css">
    <!-- Font-Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js" integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>
    <!-- highlight.js-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <!-- Customised CSS -->
    <link rel="stylesheet" href="https://kmruddy.github.iocss/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

	</head>
    <body class=" ">
        <div class="sidebar">
  <div class="container text-center ">
    <div class="sidebar-about text-center">
      <a href="https://kmruddy.github.io"> <img src="/img/kmr.jpg" alt="Author Image" class="img-circle headshot center"> </a>
      <a href="https://kmruddy.github.io"><h1 class="brand">kmruddy.com</h1></a>
      <p class="lead">
         My notes and ramblings, normally about automation 
      </p>
    </div>
    <p>
      <section class="row text-center">
	
	<a href="https://twitter.com/kmruddy"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://github.com/kmruddy"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	&nbsp;<a href="https://linkedin.com/in/kmruddy"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	&nbsp;<a href="https://stackoverflow.com/users/kmruddy"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
</section>

    </p>
    <p>
      
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="/"> <span>Home</span></a>
				</li>
				<li>
					<a href="/about/"> <span>About</span></a>
				</li>
				<li>
					<a href="/catagories/posh"> <span>PowerShell</span></a>
				</li>
				<li>
					<a href="/catagories/pcli"> <span>PowerCLI</span></a>
				</li>
				<li>
					<a href="/catagories/vbrownbag"> <span>vBrownBag</span></a>
				</li>
		</li>
	</ul>
</div>

    </p>
    <p class="copyright">&copy; 2018 Kyle Ruddy.<br />
      <a href="https://creativecommons.org/licenses/by/4.0">Some Rights Reserved</a>.<br/>Built with <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            <div class="post">
  <h1>Python - Using the vSphere Automation SDK</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       
        <i class="fas fa-calendar-alt"></i> Apr 11, 2017
      
      
      
      
        
        
            <br/>
             <i class="fas fa-tags"></i>
            
            <a class="meta" href="/tags/python">python</a> 
        
            <a class="meta" href="/tags/vmware">vmware</a>
        
      
      
      <br/>
      <i class="fas fa-clock"></i> 5 min read 
      </span>  
  </div>    
  
  

<p>We’ve been looking at how to get started using the new vSphere Automation SDKs. In the last couple parts of the series we <a href="https://blogs.vmware.com/code/2017/02/02/getting-started-vsphere-automation-sdk-rest">looked at the SDK for REST</a>, which included Postman REST client samples, as well as <a href="https://blogs.vmware.com/code/2017/02/15/getting-started-vsphere-automation-sdk-rest-p2">some JavaScript samples</a>. This time, we’ll be looking at the vSphere Automation SDK for Python!</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>There are a handful of ways to install and setup Python on your workstation, I will be walking through a high level configuration for my Mac.</p>

<p>First things first, clone the vSphere Automation SDK for Python from the VMware GitHub repository located <a href="https://github.com/vmware/vsphere-automation-sdk-python">here</a>.
<img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_09.png" alt="Cloning the Python SDK repo" /></p>

<p>After that’s complete, we’ll need to install the Python prerequisites. These include the GNU Complier Collection (GCC), a C compiler, and HomeBrew, a package management system.</p>

<p>GCC can be installed in multiple ways, but I’ve found it’s easiest to obtain it by installing the Xcode Command Line Tools. This can be done with the following command, then following the prompts:</p>

<pre><code>xcode-select --install
</code></pre>

<p><img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_01.png" alt="XCode Installation" /></p>

<p>Next, we’ll need to install the package manager, <a href="https://brew.sh/">Homebrew</a>. It can be easily downloaded and installed with the following command:</p>

<pre><code>/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</code></pre>

<p><img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_02.png" alt="Homebrew Installation" /></p>

<p>Finally, we’ll install Python in the recommended version of 3.6. It’s worth noting here that Mac OS X comes with a version of Python already installed. However, it is generally an older version (normally, Python 2.7) and is used for some system related tasks. Due to that, it is best not to modify that version or the defaults.</p>

<p>Utilizing our package manager, we’ll install Python 3.6 with the following command:</p>

<pre><code>brew install python3
</code></pre>

<p><img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_03.png" alt="Python 3.6 Installation" /></p>

<p>It’s also recommended to isolate your development environments from each other so, we’ll setup a virtual environment and jump into it. We can do that with the following commands:</p>

<pre><code>python3 -m venv SDKDemo source SDKDemo/bin/activate
</code></pre>

<p><img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_10.png" alt="Creating a virtual development environment" /></p>

<p>Lastly, we’ll install the SDK requirements. They’re listed within the root of the SDK folder in the file labeled: requirements.txt. After checking out which requirements are necessary, we’ll install those requirements by way of the following command:</p>

<pre><code>pip3 install -r requirements.txt
</code></pre>

<p><img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_11.png" alt="Requirement Installation" /></p>

<p>One other item worth mentioning is an IDE. This will make editing, running and debugging the code a lot easier to deal with. I’ll be using PyCharm, which is available <a href="https://www.jetbrains.com/pycharm/">here</a>.</p>

<h2 id="running-sample-setup-script">Running Sample Setup Script</h2>

<p>To really show off the capabilities of the SDK, there’s a sample script which takes an un-configured vSphere environment and performs all of those normal configuration steps. The environment requirements to run the script are as follows:</p>

<ul>
<li>1 vCenter Server</li>
<li>2 ESXi Hosts</li>
<li>1 NFS Datastore (minimum of 3GB free)</li>
</ul>

<p>We’ll first need to open up the testbed.py file and populate lines 17 through 29 as follows:
<img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_12.png" alt="Modification of the Testbed File" /></p>

<p>We’re now ready to set the environment up with the sample script! However, before running the script we should take a look at what it’s doing. The script is available in the SDK directory at: <code>/bin/run_sample.sh</code></p>

<p>The goal of the script is to do the following actions:</p>

<ul>
<li>Create 2 Datacenters</li>
<li>Create a Cluster</li>
<li>Create Test Folders for VM Storage</li>
<li>Attach the Hosts</li>
<li>Create a Distributed Switch</li>
<li>Create a Distributed PortGroup</li>
<li>Attach the NFS Datastore (if Selected) to the hosts</li>
<li>Copy the Photon OS ISO image downloaded from VMware&rsquo;s bintray server to the Datastore</li>
<li>Create directories to add sample ports</li>
</ul>

<p>One note before running the script, the ISO image being downloaded is roughly 200MB and could take a while depending on your bandwidth. My tests ranged anywhere between 30 seconds and 5 minutes. The sample script can be run with the following command:</p>

<pre><code>./run_sample.sh ../samples/vsphere/vcenter/setup/main.py –sv
</code></pre>

<p><img src="http://blogs.vmware.com/code/files/2017/04/Python_Main.gif" alt="Configuring an environment with the main.py file" /></p>

<h2 id="create-a-vm-with-defaults">Create a VM with Defaults</h2>

<p>Now that our environment is setup, let’s take a look at adding a VM to this environment. The easiest way is to create a default VM. This action means the API takes care of all the configuration settings based on the Guest OS version. There are some prerequisites that are required for placement such as desired datacenter, VM folder, and datastore. These are all referenced from the testbed.py configuration file we referenced in the first example.
<img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_04.png" alt="Updating the Testbed File for VM Tasks" /></p>

<p>The VM can then be created with the following command:</p>

<pre><code>./run_sample.sh ../samples/vsphere/vcenter/vm/create/create_default_vm.py –v
</code></pre>

<p><img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_05.png" alt="Default VM Creation Sample" /></p>

<p>Notice in the above example how even though we didn’t populate all of the settings, the VM received required items like a CPU, a disk, and so forth. To verify the VM does indeed exist, we can obtain a list of VMs with the following command:</p>

<pre><code>./run_sample.sh ../samples/vsphere/vcenter/vm/list_vms.py –v
</code></pre>

<p><img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_06.png" alt="List VMs Sample" /></p>

<h2 id="vm-power-actions">VM Power Actions</h2>

<p>The next logical step after creating a VM is to power it on. There’s a sample within the vm folder named power.py, which shows off all of the power actions. This file references the ‘VM_NAME_DEFAULT’ input from the testbed.py file.</p>

<p>When running the command as is, the VM will be put through the following power states:</p>

<ul>
<li>Obtain current power state</li>
<li>Power Off (NOTE: Only if the VM is currently powered on)</li>
<li>Power On</li>
<li>Suspend the VM</li>
<li>Resume the VM</li>
<li>Reset the VM</li>
</ul>

<p>The command can be run with the following:</p>

<pre><code>./run_sample.sh ../samples/vsphere/vcenter/vm/power.py –v
</code></pre>

<p><img src="http://blogs.vmware.com/code/files/2017/04/pythonSDK_07.png" alt="VM Power State Sample" /></p>

<h2 id="summary">Summary</h2>

<p>This post shows you how to easily get started with the vSphere Automation SDK for Python. It takes you through the setup of an entire environment, as well as using the individual samples. You can then take whichever is most relevant to you and apply to your environment or, pull parts of this code out and use it to automate or integrate as needed. With our SDK now being open sourced, we are intent on making sure these samples are of a high quality. If you notice areas of improvement, or come up with some new samples, please feel free to raise issues or pull requests on our <a href="https://github.com/vmware/vsphere-automation-sdk-python">GitHub repository</a>.</p>

</div>
            <div class="footer">
                <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
</script>

    

            </div>
        </div>
        
        
    </body>
</html>
