<!DOCTYPE html>
<html lang="en" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    <meta name="generator" content="Hugo 0.37.1" />
    
    <title>PowerCLI - Community Module - VMware Tools &middot; </title>
    <meta content="PowerCLI - Community Module - VMware Tools - " property="og:title">
    <meta content=" - " property="og:description">
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif:300,300i,400,400i,700,700i|Source+Code+Pro:300,300i,400,400i" rel="stylesheet">
    <link rel="stylesheet" href="https://kmruddy.github.iocss/print.css" media="print">
    <link rel="stylesheet" href="https://kmruddy.github.iocss/poole.css">
    <link rel="stylesheet" href="https://kmruddy.github.iocss/hyde.css">
    <!-- Font-Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js" integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>
    <!-- highlight.js-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <!-- Customised CSS -->
    <link rel="stylesheet" href="https://kmruddy.github.iocss/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

	</head>
    <body class=" ">
        <div class="sidebar">
  <div class="container text-center ">
    <div class="sidebar-about text-center">
      <a href="https://kmruddy.github.io"> <img src="/img/kmr.jpg" alt="Author Image" class="img-circle headshot center"> </a>
      <a href="https://kmruddy.github.io"><h1 class="brand">kmruddy.com</h1></a>
      <p class="lead">
         My notes and ramblings, normally about automation 
      </p>
    </div>
    <p>
      <section class="row text-center">
	
	<a href="https://twitter.com/kmruddy"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://github.com/kmruddy"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	&nbsp;<a href="https://linkedin.com/in/kmruddy"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	&nbsp;<a href="https://stackoverflow.com/users/kmruddy"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
</section>

    </p>
    <p>
      
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="/"> <span>Home</span></a>
				</li>
				<li>
					<a href="/about/"> <span>About</span></a>
				</li>
				<li>
					<a href="/catagories/posh"> <span>PowerShell</span></a>
				</li>
				<li>
					<a href="/catagories/pcli"> <span>PowerCLI</span></a>
				</li>
				<li>
					<a href="/catagories/vbrownbag"> <span>vBrownBag</span></a>
				</li>
		</li>
	</ul>
</div>

    </p>
    <p class="copyright">&copy; 2018 Kyle Ruddy.<br />
      <a href="https://creativecommons.org/licenses/by/4.0">Some Rights Reserved</a>.<br/>Built with <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            <div class="post">
  <h1>PowerCLI - Community Module - VMware Tools</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       
        <i class="fas fa-calendar-alt"></i> Jan 9, 2018
      
      
      
      
        
        
            <br/>
             <i class="fas fa-tags"></i>
            
            <a class="meta" href="/tags/powercli">powercli</a> 
        
            <a class="meta" href="/tags/powershell">powershell</a> 
        
            <a class="meta" href="/tags/vmware">vmware</a>
        
      
      
      <br/>
      <i class="fas fa-clock"></i> 5 min read 
      </span>  
  </div>    
  
  

<p>VMware Tools is a collection of in-guest drivers and agents that optimize performance and increase the manageability for VMs within vSphere environments. Guess what, PowerCLI provides a way to automate the management of the VMware Tools lifecycle! Even better, a new module was recently entered into the <a href="https://github.com/vmware/PowerCLI-Example-Scripts">PowerCLI Community Repository</a> to help make those management tasks even easier than before!</p>

<p>The module includes a collection of over 10 different advanced functions! These include the following:</p>

<p>Get-VMByToolsInfo | Retrieves the virtual machines with specified VMTools info.
Get-VMToolsGuestInfo | Retrieves the guest info of specified virtual machines.
Get-VMToolsInfo | Retrieves the VMTools version and build number info of specified virtual machines.
Get-VMToolsInstallLastError | Retrieves the error code of last VMTools installation on specified virtual machines.
Get-VMToolsUpgradePolicy | Gets the VMTool&rsquo;s upgrade policy of specified virtual machines.
Invoke-VMToolsListProcessInVM | Lists the running processes in the virtual machine.
Invoke-VMToolsUpgradeInVMs | Upgrades VMTools to the version bundled by ESXi host.
Invoke-VMToolsVIBInstall | Installs VMTool VIB in specified ESXi hosts.
Set-VMToolsUpgradePolicy | Sets the VMTool&rsquo;s upgrade policy to either &ldquo;manual&rdquo; or &ldquo;upgradeAtPowerCycle&rdquo; of specified virtual machines.
Update-VMToolsConfInVM | Updates the tools.conf content in guest OS.
Update-VMToolsImageLocation | Updates the /productLocker link in an ESXi host directly</p>

<p>Let&rsquo;s take a look at how to get started using this great module.</p>

<h2 id="accessing-the-module">Accessing the Module</h2>

<p>There are a couple ways to get access to this great module, all of which go through the <a href="https://github.com/vmware/PowerCLI-Example-Scripts">PowerCLI Community Repository</a>. One of the easiest ways is to load up the repository&rsquo;s page, click on the green &lsquo;Clone or download&rsquo; button, then clicking on &lsquo;Download ZIP&rsquo;. This downloads the entire contents of the repository to your local system.</p>

<p><img src="http://blogs.vmware.com/PowerCLI/files/2018/01/vmtoolsmod01.jpg" alt="Download PowerCLI Community Repository to Local System" /></p>

<p>Once the download is complete, unzip the files and browse to the &lsquo;Modules&rsquo; directory. We are now going to copy the VMToolsManagement folder and paste it in one of the directories that are listed in the PSModulePath variable. Doing this allows the module to be available for automatic importing by your PowerShell session!</p>

<p>By default, the PSModulePath variable contains the following directories:</p>

<ul>
<li>$home\Documents\WindowsPowerShell\Modules</li>
<li>$pshome\Modules</li>
</ul>

<p>In my environment, I have placed the module in the first of the above options. This is also where my PowerCLI modules are available.</p>

<p><img src="http://blogs.vmware.com/PowerCLI/files/2018/01/vmtoolsmod02.jpg" alt="Extracted Module Placed in a PSModulePath sourced location" /></p>

<p>One item to keep in mind, the &lsquo;Update-VMToolsImageLocation&rsquo; does require the usage of an ESXi host&rsquo;s SSH service. Therefore, the SSH service on the ESXi host must be running as well as having an SSH library on your local system.</p>

<h2 id="module-usage">Module Usage</h2>

<p>There are a couple functions that make it really easy and straight forward to retrieve VMware Tools information from VMs in the environment. These functions accept VM input from either direct VM parameter usage or pipeline. Here&rsquo;s example output from the following advanced functions:</p>

<ul>
<li>Get-VMToolsInfo</li>
<li>Get-VMToolsGuestInfo</li>
<li>Get-VMToolsInstallLastError</li>
</ul>

<p><img src="http://blogs.vmware.com/PowerCLI/files/2018/01/vmtoolsmod03.jpg" alt="Example of retrieving VMware Tools information from a VM" /></p>

<p>There&rsquo;s a very versatile function which allows us to query our environment for specific information about the state of VMware Tools on our VMs. This advanced function is &lsquo;Get-VMByToolsInfo&rsquo; and has a couple nice parameters to help us out. The first parameter is &lsquo;Tools Version&rsquo; which displays only VMs which contain the specified version. The next parameter is &lsquo;ToolsRunningStatus&rsquo; which displays only VMs which are of the specified running state. The last parameter is &lsquo;ToolsVersionStatus&rsquo; which displays only VMs that are of a certain status. The last two parameters feature tab complete functionality for each of their inputs.</p>

<p>Here are examples of a couple commands I ran within my environment:
<img src="http://blogs.vmware.com/PowerCLI/files/2018/01/vmtoolsmod08.jpg" alt="Example of retrieving VMs by VMware Tools configuration" /></p>

<p>Let&rsquo;s move on past simply retrieving information now. There are two functions which allow us to both retrieve and manage the upgrade policy for VMs. This can be done with the following advanced functions:</p>

<ul>
<li>Get-VMToolsUpgradePolicy</li>
<li>Set-VMToolsUpgradePolicy</li>
</ul>

<p>The Set-VMToolsUpgradePolicy allows us to modify the upgrade policy for a VM with the &lsquo;UpgradePolicy&rsquo; parameter. This parameter also allows for tab completion between the two accepted policies. Here&rsquo;s an example of those two functions in action:
<img src="http://blogs.vmware.com/PowerCLI/files/2018/01/vmtoolsmod04.jpg" alt="Example of configuring the VMware Tools Upgrade Policy for a VM" /></p>

<p>We also have the ability to change the VMware Tools logging level. This is something that is normally done internally on the guest system but, through the magic of PowerCLI, we can now do this remotely with the &lsquo;Set-VMToolsConfInVM&rsquo; advanced function! This function features a &lsquo;LogLevel&rsquo; parameter which handles the changing of log level. Tab completion is available for this parameter as well. Additional information about configuring these settings can be found in <a href="https://kb.vmware.com/kb/1007873">KB 1007873</a>. One note about this function, be aware of what the permissions are on the local system. Certain OSes can be touchy about modifying files within the folders where these configuration files are held.</p>

<p><img src="http://blogs.vmware.com/PowerCLI/files/2018/01/vmtoolsmod06.jpg" alt="Example of modifying the VMware Tools logging level" /></p>

<p>This module wouldn&rsquo;t be complete without the ability to also upgrade a system&rsquo;s VMware Tools too! This is accomplished with the &lsquo;Invoke-VMToolsUpgradeInVMs&rsquo; advanced function. Here&rsquo;s an example of it in action:
<img src="http://blogs.vmware.com/PowerCLI/files/2018/01/vmtoolsmod05.jpg" alt="Example of upgrading the VMware Tools on a specified VM" /></p>

<p>Lastly, there are two functions that help to manage VMware Tools&rsquo; accessibility directly from ESXi hosts! The &lsquo;Update-VMToolsImageLocation&rsquo; advanced function allows us to change the location of where VMware Tools are stored for ESXi hosts. For example, we could store the VMware Tools and floppy files on a datastore instead of the local system! One other nice feature of this function, there is no reboot required for the configuration update to go into effect. Then, there is the &lsquo;Invoke-VMToolsVIBInstall&rsquo; advanced function. This function allows us to install and make available updated versions of VMware Tools out of the normal ESXi update lifecycle.</p>

<p>Here&rsquo;s an example of updating an ESXi host with a newer version of VMware tools by way of a VIB:
<img src="http://blogs.vmware.com/PowerCLI/files/2018/01/vmtoolsmod07.jpg" alt="Example of updating the VMware Tools version that's available on the ESXi host" /></p>

<h2 id="summary">Summary</h2>

<p>The VMToolsManagement module is a terrific resource for any administrator needing to get quick and easy access to manage the lifecycle of VMware Tools in their environment. This module comes packed with over 10 different advanced function to handle a majority of the tasks admins face. Head out to the <a href="https://github.com/vmware/PowerCLI-Example-Scripts">PowerCLI Community Repository</a>, and download it today!</p>

</div>
            <div class="footer">
                <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
</script>

    

            </div>
        </div>
        
        
    </body>
</html>
